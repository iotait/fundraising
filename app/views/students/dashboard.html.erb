<div class="row py-3">
  <div class="col-md-6 order-md-1 col-sm-12 order-2">
    <div class="col-8 ml-8">
      <% if @student.avatar.attached? %>
        <img src="<%= url_for(@student.avatar) %>" class="rounded float-left" alt="student" width=100% height=auto>
      <% else %>
        <img src="/user-circle-solid.png" class="rounded float-left" alt="Avatar" width=100% height=auto>
      <% end %>
    </div>
  </div>
  <div class="col-md-6 order-md-2 col-sm-12 order-1 bg-primary text-light pb-3">
    <div class="d-flex align-items-center mx-auto flex-column">
      <div class="pb-7 pt-7" style="font-size: 2.5rem;font-weight: bold;"><%= @student.name %></div>
      <a href="#donate_modal" data-toggle="modal"><button type="button" id="begin_donate_button" class="btn btn-light btn-lg mt-8">Donate Now</button></a>
    </div>
  </div>
</div>

<%= render "donations/modal" %>

<div class="row ml-4 mb-7">
  <div class="col-md-6 col-sm-12">
    <h3 class="pb-5 pt-1">Donations:</h3>
    <% @student.donations.reverse.each do |donation| %>
      <div class="donation">
        <span class="amount"><%= dollar_format(donation.amount) %></span>
        "<%= donation.message %>"
        -<%= donation.donor %>
      </div>
    <% end %>
  </div>
  <div class="col-md-6 col-sm-12">
    <h3 class="pt-3">Reading Sessions:</h3>
    <%= render partial: "reading_sessions/new", locals: {student: @student, session: ReadingSession.new} %>
    <a href="#new_reading_session_modal" data-toggle="modal">Add Reading Session</a>
    <ul>
      <% @student.reading_sessions.reverse.each do |session| %>
        <%= render partial: "reading_sessions/edit", locals: {student: @student, session: session} %>
        <li>
          <%= session.time.to_s + " minutes on " + session.created_at.to_s(:long_ordinal) + " - "%>
          <a href="#edit_reading_session_modal" data-toggle="modal">Edit</a> | 
          <%= link_to("Delete", student_reading_session_path(@student, session), :method => :delete, :class => "delete") %>
        </li>
      <% end %>
    </ul>
    <div class="p-2 mb-2 bg-dark text-light"><%= "Total time reading: " + to_hours_and_mins_s(@student.mins_read) %></div>
  </div>
</div>

<script src="https://js.stripe.com/v3/"></script>
<script>
$(document).ready(function() {
  $("#donate_button").click(function() {
    $.post({
      url:'/students/<%= @student.id %>/donations',
      data: $('form').serialize(),
      success: function(response){
        var stripe = Stripe("<%= Rails.application.credentials[:stripe][Rails.env.to_sym][:publishable_key] %>");
        stripe.redirectToCheckout({
          sessionId: response.session_id
        }).then(function (result) {
          result.error.message
        });
      }
    })
  });
});
</script>
